function displayAddModal(){operationType="add";$("#add-edit-form")[0].reset();$("#modal-title").text("Yeni Şablon");$("#modal-save-button").html('<i class="las la-save"><\/i> Ekle');$("#modal-form").modal("show")}function displayEditModal(n){operationType="edit";$("#add-edit-form")[0].reset();$("#modal-title").text("Şablon Güncelleme");$("#modal-save-button").html('<i class="las la-save"><\/i> Güncelle');fetch(`${uri}/${n}`,{method:"GET",headers:jsonHeaders}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){if(n.isSuccessful){let t=n.model;console.log("template: %o",t);templateId.value=t.id;templateName.value=t.name;templateContent.value=t.content;$("#modal-form").modal("show")}else swal("Şablon Okuma Hatası",n.message,"error")}).catch(n=>{console.error("Unable to get template.",n),swal("Şablon Okuma Hatası",n,"error")})}function save(){const n={id:templateId.value.trim(),name:templateName.value.trim(),content:templateContent.value.trim()};operationType==="edit"?fetch(`${uri}/${n.id}`,{method:"PUT",headers:jsonHeaders,body:JSON.stringify(n)}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(t){t.isSuccessful?($("#add-edit-form")[0].reset(),refreshDatatable(),swal(`${n.name} adlı şablon güncellenmiştir.`,{icon:"success"})):swal("Şablon Güncelleme Hatası",t.message,"error")}).catch(n=>{console.error("Unable to update template.",n),swal("Şablon Güncelleme Hatası",n,"error")}):fetch(uri,{method:"POST",headers:jsonHeaders,body:JSON.stringify(n)}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){$("#add-edit-form")[0].reset();refreshDatatable();swal(`${n.name} adlı şablon eklenmiştir.`,{icon:"success"})}).catch(n=>{console.error("Unable to add template.",n),swal("Şablon Ekleme Hatası",n,"error")});$("#modal-form").modal("hide")}function deleteTemplate(n,t){swal({title:"Emin misiniz?",text:`${t} şablonu siliyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(i=>{i&&fetch(`${uri}/${n}`,{method:"DELETE",headers:jsonHeaders}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){console.log("data: ",n);n.isSuccessful?(refreshDatatable(),swal(`${t} adlı şablon silinmiştir.`,{icon:"success"})):swal("Şablon Silme Hatası",n.message,"error")}).catch(n=>{console.error("Unable to delete template.",n),swal("Şablon Silme Hatası",n,"error")})})}function refreshDatatable(){templatesTable.ajax.reload()}var uri="/api/Templates",templatesTable,operationType,templateId=document.getElementById("template-id"),templateName=document.getElementById("template-name"),templateContent=document.getElementById("template-content");const jsonHeaders=new Headers({Accept:"application/json","Content-Type":"application/json"});$(document).ready(function(){templatesTable=$("#templates").DataTable({dom:'rt<"row justify-content-between bottom-information"lip><"clear">',language:{url:"/lib/datatables/i18n/Turkish.json"},stateSave:!0,processing:!0,serverSide:!0,ajax:{url:`${uri}/LoadTable`,type:"POST",contentType:"application/json",dataType:"json",data:function(n){return JSON.stringify(n)}},columns:[{data:"id",visible:!1},{data:"name"},{data:"content",orderable:!1},{data:"clientCount",orderable:!1,searchable:!1},{data:"isDeleted",className:"text-center",render:function(n){return n?'<span class="btn btn-xs btn-font-sm btn-bold btn-label-danger">Silindi<\/span>':'<span class="btn btn-xs btn-font-sm btn-bold btn-label-success">Aktif<\/span>'}},{data:null,orderable:!1,searchable:!1,render:function(n,t,i){var r='<div class="action-buttons">'+`<a class="text-primary" data-toggle="tooltip" title="Güncelle" onclick="displayEditModal('${i.id}')"><i class="las la-pencil-alt la-lg"></i></a>`;return i.isDeleted?r+'<i class="las la-trash-alt la-lg ml-2"><\/i>':r+`<a class="text-danger ml-2" data-toggle="tooltip" title="Sil" onclick="deleteTemplate('${i.id}','${n.name}')"><i class="las la-trash-alt la-lg"></i></a></div>`},width:"75px"}]});$("#search").on("keyup change clear search",function(){templatesTable.search()!==this.value&&(templatesTable.search(this.value),templatesTable.columns(3).search($("#status").val()),templatesTable.draw())});$("#status").on("change",function(){templatesTable.search($("#search").value);templatesTable.columns(3).search($(this).val()).draw();templatesTable.draw()})});