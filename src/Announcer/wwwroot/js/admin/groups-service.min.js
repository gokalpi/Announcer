function displayAddModal(){operationType="add";$("#add-edit-form")[0].reset();$("#modal-title").text("Yeni Grup");$("#modal-save-button").html('<i class="las la-save"><\/i> Ekle');$("#modal-form").modal("show")}function displayEditModal(n){operationType="edit";$("#add-edit-form")[0].reset();$("#modal-title").text("Grup Güncelleme");$("#modal-save-button").html('<i class="las la-save"><\/i> Güncelle');fetch(`${uri}/${n}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){if(n.isSuccessful){let t=n.model;groupId.value=t.id;groupName.value=t.name;groupDescription.value=t.description;$("#modal-form").modal("show")}else swal("Grup Okuma Hatası",n.message,"error")}).catch(n=>{console.error("Unable to get group.",n),swal("Grup Okuma Hatası",n,"error")})}function displayGroupMembersModal(n){$("#group-members-form")[0].reset();fetch(`${uri}/${n}/Clients`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){if(n.isSuccessful){let t=n.model;groupId.value=t.id;groupName.value=t.name;groupDescription.value=t.description;$("#group-members-modal").modal("show")}else swal("Grup Okuma Hatası",n.message,"error")}).catch(n=>{console.error("Unable to get group.",n),swal("Grup Okuma Hatası",n,"error")})}function save(){const n={id:groupId.value.trim(),name:groupName.value.trim(),description:groupDescription.value.trim()};operationType==="edit"?fetch(`${uri}/${n.id}`,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(t){t.isSuccessful?($("#add-edit-form")[0].reset(),refreshDatatable(),swal(`${n.name} adlı grup güncellenmiştir.`,{icon:"success"})):swal("Grup Güncelleme Hatası",t.message,"error")}).catch(n=>{console.error("Unable to update group.",n),swal("Grup Güncelleme Hatası",n,"error")}):fetch(uri,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){$("#add-edit-form")[0].reset();refreshDatatable();swal(`${n.name} adlı grup eklenmiştir.`,{icon:"success"})}).catch(n=>{console.error("Unable to add group.",n),swal("Grup Ekleme Hatası",n,"error")});$("#modal-form").modal("hide")}function deleteGroup(n,t){swal({title:"Emin misiniz?",text:`${t} grubunu siliyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(i=>{i&&fetch(`${uri}/${n}`,{method:"DELETE"}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){n.isSuccessful?(refreshDatatable(),swal(`${t} adlı grup silinmiştir.`,{icon:"success"})):swal("Grup Silme Hatası",n.message,"error")}).catch(n=>{console.error("Unable to delete group.",n),swal("Grup Silme Hatası",n,"error")})})}function refreshDatatable(){groupsTable.ajax.reload()}var uri="/api/Groups",groupsTable,operationType,groupId=document.getElementById("group-id"),groupName=document.getElementById("group-name"),groupDescription=document.getElementById("group-description");const jsonHeaders=new Headers({Accept:"application/json","Content-Type":"application/json"});$(document).ready(function(){groupsTable=$("#groups").DataTable({dom:'rt<"row justify-content-between bottom-information"lip><"clear">',language:{url:"/lib/datatables/i18n/Turkish.json"},stateSave:!0,processing:!0,serverSide:!0,ajax:{url:`${uri}/LoadTable`,type:"POST",contentType:"application/json",dataType:"json",data:function(n){return JSON.stringify(n)}},columns:[{data:"id",visible:!1},{data:"name"},{data:"description"},{data:"clientCount",orderable:!1,searchable:!1,className:"text-center",render:function(n,t,i){return`<a class="btn btn-success btn-xs btn-font-sm btn-bold rounded-circle" data-toggle="tooltip" title="Güncelle" onclick="displayGroupMembersModal(${i.id})">${n}</a>`}},{data:"notificationsReceivedCount",orderable:!1,searchable:!1,className:"text-center"},{data:"isDeleted",className:"text-center",render:function(n){return n?`<span class="btn btn-xs btn-font-sm btn-bold btn-label-danger">Silindi</span>`:`<span class="btn btn-xs btn-font-sm btn-bold btn-label-success">Aktif</span>`}},{data:null,orderable:!1,searchable:!1,render:function(n,t,i){var r='<div class="action-buttons">'+`<a class="text-primary" data-toggle="tooltip" title="Güncelle" onclick="displayEditModal('${i.id}')"><i class="las la-pencil-alt la-lg"></i></a>`;return i.isDeleted?r+'<i class="las la-trash-alt la-lg ml-2"><\/i>':r+`<a class="text-danger ml-2" data-toggle="tooltip" title="Sil" onclick="deleteGroup('${i.id}','${n.name}')"><i class="las la-trash-alt la-lg"></i></a></div>`},width:"75px"}]});$("#search").on("keyup change clear search",function(){groupsTable.search()!==this.value&&(groupsTable.search(this.value),groupsTable.columns(3).search($("#status").val()),groupsTable.draw())});$("#status").on("change",function(){groupsTable.search($("#search").value);groupsTable.columns(3).search($(this).val()).draw();groupsTable.draw()})});