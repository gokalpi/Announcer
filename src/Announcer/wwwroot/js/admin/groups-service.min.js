function compareClients(n,t){const r=n.name.toUpperCase(),u=t.name.toUpperCase();let i=0;return r>u?i=1:r<u&&(i=-1),i}function deleteGroup(n,t){swal({title:"Emin misiniz?",text:`${t} adlı grubu siliyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t&&deleteJSON(`${groupsUri}/${n}`,showDeleteGroupResult)})}function displayAddModal(){operationType="add";$("#add-edit-form")[0].reset();$("#modal-title").text("Yeni Grup");$("#modal-save-button").html('<i class="las la-save"><\/i> Ekle');$("#modal-form").modal("show")}function displayClientsModal(n){$("#group-members-form")[0].reset();$("#group").val(n);getJSON(`${groupsUri}/${n}/Clients`,setClientsModalData)}function displayEditModal(n){operationType="edit";$("#add-edit-form")[0].reset();$("#modal-title").text("Grup Güncelleme");$("#modal-save-button").html('<i class="las la-save"><\/i> Güncelle');getJSON(`${groupsUri}/${n}`,setEditModalData)}function displayAddClient(n,t,i){return`<div>${i}</div>`+`<a class="text-success" data-toggle="tooltip" title="Grupa Ekle" onclick="addClient(${n}, '${t}', '${i}')">`+'<i class="las la-plus-circle"><\/i><\/a>'}function displayRemoveClient(n,t,i){return`<div>${i}</div>`+`<a class="text-danger" data-toggle="tooltip" title="Gruptan Çıkar" onclick="removeClient(${n}, '${t}', '${i}')">`+'<i class="las la-minus-circle"><\/i><\/a>'}function addClient(n,t,i){swal({title:"Emin misiniz?",text:`${i} adlı istemciyi üye yapıyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(i=>{if(i){const i={groupId:parseInt(n),clientId:t};postJSON(`${clientsUri}/${t}/Groups`,i,showAddClientResult)}})}function removeClient(n,t,i){swal({title:"Emin misiniz?",text:`${i} adlı istemciyi üyelikten çıkartmak istiyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(i=>{i&&deleteJSON(`${clientsUri}/${t}/Groups/${n}`,showRemoveClientResult)})}function refreshDatatable(){groupsTable.ajax.reload()}function refreshSubscribedClients(){const t=$("#group").val();var n=$("#subscribed-clients-list");n.empty();n.append(subscribedClients.map(n=>'<li class="list-group-item">'+displayRemoveClient(t,n.id,n.name)+"<\/li>"))}function save(){const n={id:parseInt(groupId.val().trim()),name:groupName.val().trim(),description:groupDescription.val().trim()};operationType==="edit"?putJSON(`${groupsUri}/${n.id}`,n,showEditResult):postJSON(groupsUri,n,showAddGroupResult);$("#modal-form").modal("hide")}function setClients(n){n.isSuccessful?clients=n.model:swal("İstemci Okuma Hatası",n.message,"error")}function setClientsModalData(n){n.isSuccessful?(subscribedClients=n.model,refreshSubscribedClients(),$("#subscribed-clients-modal").modal("show")):swal("İstemci Okuma Hatası",n.message,"error")}function setEditModalData(n){if(n.isSuccessful){let t=n.model;groupId.val(t.id);groupName.val(t.name);groupDescription.val(t.description);$("#modal-form").modal("show")}else swal("Grup Okuma Hatası",n.message,"error")}function showAddGroupResult(n){n?(refreshDatatable(),swal(`${n.name} adlı grup eklenmiştir.`,{icon:"success"})):swal("Grup Ekleme Hatası","Grup Eklenenemiştir","error")}function showDeleteGroupResult(n){n.isSuccessful?(refreshDatatable(),swal("Grup silinmiştir.",{icon:"success"})):swal("Grup Silme Hatası",n.message,"error")}function showEditResult(n){n.isSuccessful?($("#add-edit-form")[0].reset(),refreshDatatable(),swal(`${n.model.name} adlı grup güncellenmiştir.`,{icon:"success"})):swal("Grup Güncelleme Hatası",n.message,"error")}function showAddClientResult(n){if(n.isSuccessful){subscribedClients.push({id:n.model.clientId,name:n.model.client});subscribedClients=subscribedClients.sort(compareClients);refreshSubscribedClients();var t=$("#result-"+n.model.clientId.replace(new RegExp("[.]","g"),"-"));t.html(displayRemoveClient(n.model.groupId,n.model.clientId,n.model.client));swal(`${n.model.client} adlı istemci üye yapıldı.`,{icon:"success"})}else swal("İstemci Ekleme Hatası","İstemci Üye Olamamıştır","error")}function showRemoveClientResult(n){if(n.isSuccessful){subscribedClients=subscribedClients.filter(t=>t.id!==n.model.clientId);refreshSubscribedClients();var t=$("#result-"+n.model.clientId.replace(new RegExp("[.]","g"),"-"));t.html(displayAddClient(n.model.groupId,n.model.clientId,n.model.client));swal(`${n.model.client} istemcisi üyelikten çıkartılmıştır.`,{icon:"success"})}else swal("Üyelikten Çıkarma Hatası",n.message,"error")}var baseUri="/api",groupsUri=baseUri+"/Groups",clientsUri=baseUri+"/Clients",groupsTable,operationType,clients={},subscribedClients={},groupId=$("#group-id"),groupName=$("#group-name"),groupDescription=$("#group-description");$(document).ready(function(){getJSON(clientsUri,setClients);groupsTable=$("#groups").DataTable({dom:'rt<"row justify-content-between bottom-information"lip><"clear">',language:{url:"/lib/datatables/i18n/Turkish.json"},stateSave:!0,processing:!0,serverSide:!0,ajax:{url:`${groupsUri}/LoadTable`,type:"POST",contentType:"application/json",dataType:"json",data:function(n){return JSON.stringify(n)}},columns:[{data:"id",visible:!1},{data:"name"},{data:"description"},{data:"clientCount",orderable:!1,searchable:!1,className:"text-center",render:function(n,t,i){return`<a class="badge badge-md badge-primary" data-toggle="tooltip" title="İstemciler" onclick="displayClientsModal(${i.id})">${n}</a>`}},{data:"notificationsReceivedCount",orderable:!1,searchable:!1,className:"text-center"},{data:"isDeleted",className:"text-center",render:function(n){return n?'<span class="badge badge-pill badge-danger">Silindi<\/span>':'<span class="badge badge-pill badge-success">Aktif<\/span>'}},{data:null,orderable:!1,searchable:!1,render:function(n,t,i){var r='<div class="action-buttons">'+`<a class="text-primary" data-toggle="tooltip" title="Güncelle" onclick="displayEditModal('${i.id}')"><i class="las la-pencil-alt la-lg"></i></a>`;return i.isDeleted?r+'<i class="las la-trash-alt la-lg ml-2"><\/i>':r+`<a class="text-danger ml-2" data-toggle="tooltip" title="Sil" onclick="deleteGroup(${i.id}, '${n.name}')"><i class="las la-trash-alt la-lg"></i></a></div>`},width:"75px"}]});$("#search").on("keyup change clear search",function(){groupsTable.search()!==this.value&&(groupsTable.search(this.value),groupsTable.columns(3).search($("#status").val()),groupsTable.draw())});$("#search-client").on("keyup change clear search",function(){var t=$("#search-result"),n;if(t.empty(),n=$(this).val(),n.length>2){const i=$("#group").val(),r=clients.filter(t=>t.id.toUpperCase().includes(n.toUpperCase())||t.name.toUpperCase().includes(n.toUpperCase()));t.append(r.map(n=>{var t='<li class="list-group-item" id="result-'+n.id.replace(new RegExp("[.]","g"),"-")+'">';return t+=subscribedClients.some(t=>t.id===n.id)?displayRemoveClient(i,n.id,n.name):displayAddClient(i,n.id,n.name),t+"<\/li>"}))}});$("#status").on("change",function(){groupsTable.search($("#search").value);groupsTable.columns(3).search($(this).val()).draw();groupsTable.draw()})});