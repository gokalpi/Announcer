function compareGroups(n,t){const r=n.name.toUpperCase(),u=t.name.toUpperCase();let i=0;return r>u?i=1:r<u&&(i=-1),i}function deleteClient(n,t){swal({title:"Emin misiniz?",text:`${t} adlı istemciyi siliyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t&&deleteJSON(`${clientsUri}/${n}`,showDeleteClientResult)})}function displayAddModal(){operationType="add";$("#add-edit-form")[0].reset();$("#modal-title").text("Yeni İstemci");$("#modal-save-button").html('<i class="las la-save"><\/i> Ekle');$("#client-id").attr("readonly",!1);$("#modal-form").modal("show")}function displayEditModal(n){operationType="edit";$("#add-edit-form")[0].reset();$("#modal-title").text("İstemci Güncelleme");$("#modal-save-button").html('<i class="las la-save"><\/i> Güncelle');getJSON(`${clientsUri}/${n}`,setEditModalData)}function displayGroupsModal(n){$("#group-members-form")[0].reset();$("#client").val(n);getJSON(`${clientsUri}/${n}/Groups`,setGroupsModalData)}function displayJoinGroup(n,t,i){return`<div>${i}</div>`+`<a class="text-success" data-toggle="tooltip" title="Grupa Üye Ol" onclick="joinGroup('${n}', ${t}, '${i}')">`+'<i class="las la-plus-circle"><\/i><\/a>'}function displayLeaveGroup(n,t,i){return`<div>${i}</div>`+`<a class="text-danger" data-toggle="tooltip" title="Gruptan Çık" onclick="leaveGroup('${n}', ${t}, '${i}')">`+'<i class="las la-minus-circle"><\/i><\/a>'}function joinGroup(n,t,i){swal({title:"Emin misiniz?",text:`${i} adlı gruba üye oluyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(i=>{if(i){const i={groupId:parseInt(t),clientId:n};postJSON(`${clientsUri}/${n}/Groups`,i,showJoinGroupResult)}})}function leaveGroup(n,t,i){swal({title:"Emin misiniz?",text:`${i} adlı gruptan çıkmak istiyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(i=>{i&&deleteJSON(`${clientsUri}/${n}/Groups/${t}`,showLeaveGroupResult)})}function refreshDatatable(){clientsTable.ajax.reload()}function refreshSubscribedGroups(){const t=$("#client").val();console.log("subscribedGroups",subscribedGroups);var n=$("#subscribed-groups-list");n.empty();n.append(subscribedGroups.map(n=>'<li class="list-group-item">'+displayLeaveGroup(t,n.id,n.name)+"<\/li>"))}function save(){const n={id:clientId.val().trim(),name:clientName.val().trim(),description:clientDescription.val().trim(),templateId:parseInt(clientTemplate.val().trim())};operationType==="edit"?putJSON(`${clientsUri}/${n.id}`,n,showEditResult):postJSON(clientsUri,n,showAddClientResult);$("#modal-form").modal("hide")}function setGroups(n){n.isSuccessful?groups=n.model:swal("Grup Okuma Hatası",n.message,"error")}function setGroupsModalData(n){n.isSuccessful?(subscribedGroups=n.model,refreshSubscribedGroups(),$("#subscribed-groups-modal").modal("show")):swal("İstemci Okuma Hatası",n.message,"error")}function setEditModalData(n){if(n.isSuccessful){let t=n.model;clientId.val(t.id);clientId.readOnly=!0;clientName.val(t.name);clientDescription.val(t.description);clientTemplate.val(t.templateId);$("#modal-form").modal("show")}else swal("İstemci Okuma Hatası",n.message,"error")}function setTemplates(n){if(n.isSuccessful){if(templates=n.model,templates){var t=$("#client-template");t.empty();t.append(templates.map(n=>'<option value="'+n.id+'">'+n.name+"<\/option>"))}}else swal("Şablon Okuma Hatası",n.message,"error")}function showAddClientResult(n){n?(refreshDatatable(),swal(`${n.name} adlı istemci eklenmiştir.`,{icon:"success"})):swal("İstemci Ekleme Hatası","İstemci Eklenenemiştir","error")}function showDeleteClientResult(n){n.isSuccessful?(refreshDatatable(),swal("İstemci silinmiştir.",{icon:"success"})):swal("İstemci Silme Hatası",n.message,"error")}function showEditResult(n){n.isSuccessful?($("#add-edit-form")[0].reset(),refreshDatatable(),swal(`${n.model.name} adlı istemci güncellenmiştir.`,{icon:"success"})):swal("İstemci Güncelleme Hatası",n.message,"error")}function showJoinGroupResult(n){if(n.isSuccessful){subscribedGroups.push({id:n.model.groupId,name:n.model.group});subscribedGroups=subscribedGroups.sort(compareGroups);refreshSubscribedGroups();var t=$("#result-"+n.model.groupId);t.html(displayLeaveGroup(n.model.clientId,n.model.groupId,n.model.group));swal(`${n.model.group} adlı gruba üye olundu.`,{icon:"success"})}else swal("Gruba Ekleme Hatası","Gruba Üye Olunamamıştır","error")}function showLeaveGroupResult(n){if(n.isSuccessful){subscribedGroups=subscribedGroups.filter(t=>t.id!==n.model.groupId);refreshSubscribedGroups();var t=$("#result-"+n.model.groupId);t.html(displayJoinGroup(n.model.clientId,n.model.groupId,n.model.group));swal(`${n.model.group} grubundan çıkılmıştır.`,{icon:"success"})}else swal("Gruptan Çıkma Hatası",n.message,"error")}var baseUri="/api",clientsUri=baseUri+"/Clients",groupsUri=baseUri+"/Groups",templatesUri=baseUri+"/Templates",clientsTable,operationType,groups={},subscribedGroups={},templates={},clientId=$("#client-id"),clientName=$("#client-name"),clientDescription=$("#client-description"),clientTemplate=$("#client-template");$(document).ready(function(){getJSON(groupsUri,setGroups);getJSON(templatesUri,setTemplates);clientsTable=$("#clients").DataTable({dom:'rt<"row justify-content-between bottom-information"lip><"clear">',language:{url:"/lib/datatables/i18n/Turkish.json"},stateSave:!0,processing:!0,serverSide:!0,ajax:{url:`${clientsUri}/LoadTable`,type:"POST",contentType:"application/json",dataType:"json",data:function(n){return JSON.stringify(n)}},columns:[{data:"id"},{data:"name"},{data:"description"},{data:"templateName",orderable:!1},{data:"groupCount",orderable:!1,searchable:!1,className:"text-center",render:function(n,t,i){return`<a class="badge badge-md badge-primary" data-toggle="tooltip" title="Gruplar" onclick="displayGroupsModal('${i.id}')">${n}</a>`}},{data:"notificationsSentCount",orderable:!1,searchable:!1,className:"text-center"},{data:"notificationsReceivedCount",orderable:!1,searchable:!1,className:"text-center"},{data:"isDeleted",className:"text-center",render:function(n){return n?'<span class="badge badge-pill badge-danger">Silindi<\/span>':'<span class="badge badge-pill badge-success">Aktif<\/span>'}},{data:null,orderable:!1,searchable:!1,render:function(n,t,i){var r='<div class="action-buttons">'+`<a class="text-primary" data-toggle="tooltip" title="Güncelle" onclick="displayEditModal('${i.id}')"><i class="las la-pencil-alt la-lg"></i></a>`;return i.isDeleted?r+'<i class="las la-trash-alt la-lg ml-2"><\/i>':r+`<a class="text-danger ml-2" data-toggle="tooltip" title="Sil" onclick="deleteClient('${i.id}', '${n.name}')"><i class="las la-trash-alt la-lg"></i></a></div>`},width:"75px"}]});$("#search").on("keyup change clear search",function(){clientsTable.search()!==$(this).val()&&(clientsTable.search($(this).val()),clientsTable.columns(3).search($("#status").val()),clientsTable.draw())});$("#search-group").on("keyup change clear search",function(){var t=$("#search-result"),n;if(t.empty(),n=$(this).val(),n.length>2){const i=$("#client").val(),r=groups.filter(t=>t.name.toUpperCase().includes(n.toUpperCase()));t.append(r.map(n=>{var t='<li class="list-group-item" id="result-'+n.id+'">';return t+=subscribedClients.some(t=>t.id===n.id)?displayLeaveGroup(i,n.id,n.name):displayJoinGroup(i,n.id,n.name),t+"<\/li>"}))}});$("#status").on("change",function(){clientsTable.search($("#search").val());clientsTable.columns(3).search($(this).val()).draw();clientsTable.draw()})});