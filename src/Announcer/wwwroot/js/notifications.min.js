function start(){connection.start().then(function(){connection.state===signalR.HubConnectionState.Connected&&(console.log("Connected to hub at "+hubUri),getClientInfo(clientId))}).catch(n=>{displayError(n),connection.state===signalR.HubConnectionState.Disconnected&&setTimeout(()=>start(),5e3)})}function joinGroup(n){n&&connection.invoke("AddToGroupAsync",n).then(function(){}).catch(n=>displayError(n))}function leaveGroup(n){n&&connection.invoke("RemoveFromGroupAsync",n).then(function(){}).catch(n=>displayError(n))}function createElement(n,t,i,r,u,f){let e=document.createElement(n);return t&&(e.id=t),i&&(e.name=i),r&&(e.className=r),u?e.innerHTML=u:f&&(e.innerText=f),e}function displayClock(){let n=document.getElementById("clock");n&&(n.innerText=new Intl.DateTimeFormat("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date));setTimeout(function(){displayClock()},1e3)}function displayError(n){var t=document.getElementById("error-pane"),i=document.getElementById("error-message");i.innerText=n;t.style=""}function displayHeaders(n){var t,i;n&&(t=document.getElementById("notifications-header"),t&&(t.querySelectorAll("*").forEach(n=>n.remove()),infoColumnCount=n.columns.length>0?n.columns.length-1:0,i=document.createDocumentFragment(),n.columns.forEach(n=>{i.appendChild(createElement("th",null,null,null,n,null))}),t.appendChild(i)))}function displayLastUpdate(){let n=document.getElementById("last-update");n&&(n.innerText=new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date))}function displayNotification(n,t){var f=JSON.parse(t),c=slugify(n),i=document.getElementById(c),o,r,s,e,u,h;if(i){for(o=i.getElementsByClassName("group-col"),r=0;r<o.length;r++)f.columns[r]&&(o[r].innerHTML=f.columns[r]);i.className="notification-item active";setTimeout(()=>i.className="notification-item",6500)}else if(s=document.getElementById("notifications-body"),s){for(i=createElement("tr",c,null,"notification-item active",null,null),setTimeout(()=>i.className="notification-item",6500),e=document.createDocumentFragment(),e.appendChild(createElement("td",null,null,"group-name",n,null)),u=0;u<infoColumnCount;u++)h=createElement("td",null,null,"group-col",null,null),f.columns[u]&&(h.innerHTML=f.columns[u]),e.appendChild(h);i.appendChild(e);s.appendChild(i)}i&&displayLastUpdate()}function displayNotifications(n){if(n.isSuccessful){let i=n.model;for(var t=0;t<i.length;t++)displayNotification(i[t].group,i[t].content)}else displayError("İstemcinin mesajları okunamadı. "+data.message)}function getClientInfo(n){if(!n)return null;getJSON(`${clientUri}/${n}`,setClientInfo)}function getNotifications(n){n&&getJSON(`${clientUri}/${n}/GroupNotifications`,displayNotifications)}function setClientId(n){var t;if(n&&n.trim().length>0)t=n;else{const n=new URLSearchParams(window.location.search);t=n.get("id")}return t&&t.trim().length>0?(t=t.trim(),document.getElementById("client-id").innerText=t,t):(displayError("İstemci bilgisi bulunamadı"),null)}function setClientInfo(n){if(n.isSuccessful){let i=n.model;if(i.templateContent){let n=JSON.parse(i.templateContent);if(displayHeaders(n.header),i.groups&&i.groups.length>0){groups=i.groups.map(n=>n.group).sort();for(var t=0;t<groups.length;t++)displayNotification(groups[t],'{ "columns": [ "", "" ] }'),joinGroup(groups[t]);getNotifications(i.id)}else displayError("İstemcinin üye olduğu gruplar bulunamadı.")}}else displayError("İstemci bilgisi okunamadı. "+data.message)}function setOrganizationName(n){n.isSuccessful?(organizationName=n.model.value,organizationName&&(document.getElementById("organizationName").innerText=organizationName)):swal?swal("Organizasyon Adı Okuma Hatası",n.message,"error"):alert("Organizasyon Adı Okuma Hatası"+n.message)}function slugify(n){var t={"çÇ":"c","ğĞ":"g","şŞ":"s","üÜ":"u","ıİ":"i","öÖ":"o"};for(var i in t)n=n.replace(new RegExp("["+i+"]","g"),t[i]);return n.replace(/[^-a-zA-Z0-9\s]+/ig,"").replace(/\s/gi,"-").replace(/[-]+/gi,"-").toLowerCase()}var hubUri="/NotificationHub",clientUri="/api/Clients",settingsUri="/api/Settings",infoColumnCount=0,groups,connection=(new signalR.HubConnectionBuilder).withUrl(hubUri).withAutomaticReconnect().configureLogging(signalR.LogLevel.Error).build();connection.onreconnecting(n=>{var i,t,u,r;for(console.log("Reconnecting"),document.getElementById("loader-wrapper").hidden=!1,i=document.getElementsByClassName("notification-item"),t=0;t<i.length;t++)for(i[t].className="notification-item disconnected",u=i[t].getElementsByClassName("group-col"),r=0;r<u.length;r++)u[r].innerHTML="";console.assert(connection.state===signalR.HubConnectionState.Reconnecting);console.warn(`Connection lost due to error "${n}". Reconnecting.`)});connection.onreconnected(n=>{var i,t;for(console.log("Reconnected"),document.getElementById("loader-wrapper").hidden=!0,i=document.getElementsByClassName("notification-item"),t=0;t<i.length;t++)i[t].className="notification-item";console.assert(connection.state===signalR.HubConnectionState.Connected);getClientInfo(clientId);console.warn(`Connection reestablished and joined to the groups. Connected with connectionId "${n}".`)});connection.onclose(n=>{if(console.assert(connection.state===signalR.HubConnectionState.Disconnected),groups)for(var t=0;t<groups.length;t++)console.log("On close - leaving groups[%d]: %o",t,groups[t]),leaveGroup(groups[t]);console.warn("Connection closed due to error "+n+". Try refreshing this page to restart the connection.")});connection.on("UserConnected",function(n){console.log(`Client connected with connection id "${n}"`)});connection.on("UserDisconnected",function(n,t){console.log(`Client disconnected with connection id "${t}"`)});connection.on("JoinedGroup",function(n,t){console.log(`Client "${n}" joined to group "${t}"`)});connection.on("LeftGroup",function(n,t){console.log(`Client "${n}" left group "${t}"`)});connection.on("ReceiveGroupMessage",function(n){displayNotification(n.group,n.message)});connection.on("ReceiveMessage",function(n){var t=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");console.log(t)});