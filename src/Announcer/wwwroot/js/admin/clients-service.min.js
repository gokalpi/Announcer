function displayAddModal(){operationType="add";$("#add-edit-form")[0].reset();$("#modal-title").text("Yeni İstemci");$("#modal-save-button").html('<i class="las la-save"><\/i> Ekle');clientId.readOnly=!1;$("#modal-form").modal("show")}function displayEditModal(n){operationType="edit";$("#add-edit-form")[0].reset();$("#modal-title").text("İstemci Güncelleme");$("#modal-save-button").html('<i class="las la-save"><\/i> Güncelle');fetch(`${clientsUri}/${n}`,{method:"GET",headers:jsonHeaders}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){if(n.isSuccessful){let t=n.model;clientId.value=t.id;clientId.readOnly=!0;clientName.value=t.name;clientDescription.value=t.description;clientTemplate.value=t.templateId;$("#modal-form").modal("show")}else swal("İstemci Okuma Hatası",n.message,"error")}).catch(n=>{console.error("Unable to get client.",n),swal("İstemci Okuma Hatası",n,"error")})}function getAllGroups(){fetch(groupsUri,{method:"GET",headers:jsonHeaders}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){n.isSuccessful?groups=n.model:swal("Grup Okuma Hatası",n.message,"error")}).catch(n=>{console.error("Unable to get groups.",n),swal("Grup Okuma Hatası",n,"error")})}function getAllTemplates(){fetch(templatesUri,{method:"GET",headers:jsonHeaders}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){var r,u,t,i;if(n.isSuccessful){if(templates=n.model,templates){for(r=$("#client-template"),r.empty(),u=document.createDocumentFragment(),t=0;t<templates.length;t++)i=document.createElement("option"),i.value=templates[t].id,i.innerText=templates[t].name,u.appendChild(i);r.append(u)}}else swal("Şablon Okuma Hatası",n.message,"error")}).catch(n=>{console.error("Unable to get templates.",n),swal("Şablon Okuma Hatası",n,"error")})}function save(){const n={id:clientId.value.trim(),name:clientName.value.trim(),description:clientDescription.value.trim(),templateId:clientTemplate.value.trim()};operationType==="edit"?fetch(`${clientsUri}/${n.id}`,{method:"PUT",headers:jsonHeaders,body:JSON.stringify(n)}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(t){t.isSuccessful?($("#add-edit-form")[0].reset(),refreshDatatable(),swal(`${n.name} adlı istemci güncellenmiştir.`,{icon:"success"})):swal("İstemci Güncelleme Hatası",t.message,"error")}).catch(n=>{console.error("Unable to update client.",n),swal("İstemci Güncelleme Hatası",n,"error")}):fetch(clientsUri,{method:"POST",headers:jsonHeaders,body:JSON.stringify(n)}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){$("#add-edit-form")[0].reset();refreshDatatable();swal(`${n.name} adlı istemci eklenmiştir.`,{icon:"success"})}).catch(n=>{console.error("Unable to add client.",n),swal("İstemci Ekleme Hatası",n,"error")});$("#modal-form").modal("hide")}function deleteClient(n,t){swal({title:"Emin misiniz?",text:`${t} adlı istemciyi siliyorsunuz.`,icon:"warning",buttons:!0,dangerMode:!0}).then(i=>{i&&fetch(`${clientsUri}/${n}`,{method:"DELETE"}).then(function(n){if(!n.ok)throw Error(`${n.status} status code received.`);return n.json()}).then(function(n){n.isSuccessful?(refreshDatatable(),swal(`${t} adlı istemci silinmiştir.`,{icon:"success"})):swal("Grup Silme Hatası",n.message,"error")}).catch(n=>{console.error("Unable to delete client.",n),swal("İstemci Silme Hatası",n,"error")})})}function refreshDatatable(){clientsTable.ajax.reload()}var baseUri="/api",clientsUri=baseUri+"/Clients",groupsUri=baseUri+"/Groups",templatesUri=baseUri+"/Templates",clientsTable,operationType,groups,templates,clientId=document.getElementById("client-id"),clientName=document.getElementById("client-name"),clientDescription=document.getElementById("client-description"),clientTemplate=document.getElementById("client-template");const jsonHeaders=new Headers({Accept:"application/json","Content-Type":"application/json"});$(document).ready(function(){getAllGroups();getAllTemplates();clientsTable=$("#clients").DataTable({dom:'rt<"row justify-content-between bottom-information"lip><"clear">',language:{url:"/lib/datatables/i18n/Turkish.json"},stateSave:!0,processing:!0,serverSide:!0,ajax:{url:`${clientsUri}/LoadTable`,type:"POST",contentType:"application/json",dataType:"json",data:function(n){return JSON.stringify(n)}},columns:[{data:"id"},{data:"name"},{data:"description"},{data:"templateName",orderable:!1},{data:"groupCount",orderable:!1,searchable:!1,className:"text-center"},{data:"notificationsSentCount",orderable:!1,searchable:!1,className:"text-center"},{data:"notificationsReceivedCount",orderable:!1,searchable:!1,className:"text-center"},{data:"isDeleted",className:"text-center",render:function(n){return n?`<span class="btn btn-xs btn-font-sm btn-bold btn-label-danger">Silindi</span>`:`<span class="btn btn-xs btn-font-sm btn-bold btn-label-success">Aktif</span>`}},{data:null,orderable:!1,searchable:!1,render:function(n,t,i){var r='<div class="action-buttons">'+`<a class="text-primary" data-toggle="tooltip" title="Güncelle" onclick="displayEditModal('${i.id}')"><i class="las la-pencil-alt la-lg"></i></a>`;return i.isDeleted?r+'<i class="las la-trash-alt la-lg ml-2"><\/i>':r+`<a class="text-danger ml-2" data-toggle="tooltip" title="Sil" onclick="deleteClient('${i.id}','${n.name}')"><i class="las la-trash-alt la-lg"></i></a></div>`},width:"75px"}]});$("#search").on("keyup change clear search",function(){clientsTable.search()!==this.value&&(clientsTable.search(this.value),clientsTable.columns(3).search($("#status").val()),clientsTable.draw())});$("#status").on("change",function(){clientsTable.search($("#search").value);clientsTable.columns(3).search($(this).val()).draw();clientsTable.draw()})});